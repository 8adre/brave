<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (13.0.2) on Mon Apr 06 06:03:21 UTC 2020 -->
<title>FinishedSpanHandler (Brave 5.11.2 API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2020-04-06">
<meta name="description" content="declaration: package: brave.handler, class: FinishedSpanHandler">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../script-dir/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
<script type="text/javascript" src="../../script-dir/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../script-dir/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../script-dir/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../script-dir/jquery-3.4.1.js"></script>
<script type="text/javascript" src="../../script-dir/jquery-ui.js"></script>
</head>
<body class="class-declaration">
<script type="text/javascript">var data = {"i0":10,"i1":6,"i2":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/FinishedSpanHandler.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<div class="navListSearch"><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</div>
</div>
<a id="skip.navbar.top">
<!--   -->
</a>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">brave.handler</a></div>
<h1 title="Class FinishedSpanHandler" class="title">Class FinishedSpanHandler</h1>
</div>
<div class="contentContainer">
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang" class="externalLink">java.lang.Object</a>
<div class="inheritance">brave.handler.FinishedSpanHandler</div>
</div>
<section class="description">
<hr>
<pre>public abstract class <span class="typeNameLabel">FinishedSpanHandler</span>
extends <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang" class="externalLink">Object</a></pre>
<div class="block">Triggered on each finished span except when spans that are <a href="../Span.html#isNoop()"><code>no-op</code></a>.

 <p><a href="../propagation/SamplingFlags.html#sampled()"><code>Sampled spans</code></a> hit this stage before reporting to Zipkin.
 This means changes to the mutable span will reflect in reported data.

 <p>When Zipkin's reporter is <code>Reporter.NOOP</code> or the context is
 unsampled, this will still receive spans where <a href="../propagation/SamplingFlags.html#sampledLocal()"><code>SamplingFlags.sampledLocal()</code></a> is true.</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>5.4</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="#alwaysSampleLocal()"><code>alwaysSampleLocal()</code></a></dd>
</dl>
</section>
<section class="summary">
<ul class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<li class="blockList">
<section class="fieldSummary"><a id="field.summary">
<!--   -->
</a>
<h2>Field Summary</h2>
<div class="memberSummary">
<table>
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<thead>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Field</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor">
<td class="colFirst"><code>static <a href="FinishedSpanHandler.html" title="class in brave.handler">FinishedSpanHandler</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#NOOP">NOOP</a></span></code></th>
<td class="colLast">
<div class="block">Use to avoid comparing against null references</div>
</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li class="blockList">
<section class="constructorSummary"><a id="constructor.summary">
<!--   -->
</a>
<h2>Constructor Summary</h2>
<div class="memberSummary">
<table>
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<thead>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E()">FinishedSpanHandler</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li class="blockList">
<section class="methodSummary"><a id="method.summary">
<!--   -->
</a>
<h2>Method Summary</h2>
<div class="memberSummary">
<div role="tablist" aria-orientation="horizontal"><button role="tab" aria-selected="true" aria-controls="memberSummary_tabpanel" tabindex="0" onkeydown="switchTab(event)" id="t0" class="activeTableTab">All Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t2" class="tableTab" onclick="show(2);">Instance Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t3" class="tableTab" onclick="show(4);">Abstract Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t4" class="tableTab" onclick="show(8);">Concrete Methods</button></div>
<div id="memberSummary_tabpanel" role="tabpanel">
<table aria-labelledby="t0">
<thead>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor" id="i0">
<td class="colFirst"><code>boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#alwaysSampleLocal()">alwaysSampleLocal</a></span>()</code></th>
<td class="colLast">
<div class="block">When true, all spans become real spans even if they aren't sampled remotely.</div>
</td>
</tr>
<tr class="rowColor" id="i1">
<td class="colFirst"><code>abstract boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#handle(brave.propagation.TraceContext,brave.handler.MutableSpan)">handle</a></span>&#8203;(<a href="../propagation/TraceContext.html" title="class in brave.propagation">TraceContext</a>&nbsp;context,
<a href="MutableSpan.html" title="class in brave.handler">MutableSpan</a>&nbsp;span)</code></th>
<td class="colLast">
<div class="block">This is invoked after a span is finished, allowing data to be modified or reported out of
 process.</div>
</td>
</tr>
<tr class="altColor" id="i2">
<td class="colFirst"><code>boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#supportsOrphans()">supportsOrphans</a></span>()</code></th>
<td class="colLast">
<div class="block">Normally, <a href="#handle(brave.propagation.TraceContext,brave.handler.MutableSpan)"><code>handle(TraceContext, MutableSpan)</code></a> is only called upon explicit termination
 of a span: <a href="../Span.html#finish()"><code>Span.finish()</code></a>, <a href="../Span.html#finish(long)"><code>Span.finish(long)</code></a> or <a href="../Span.html#flush()"><code>Span.flush()</code></a>.</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="inheritedList">
<h3>Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang" class="externalLink">Object</a></h3>
<a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang" class="externalLink">clone</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang" class="externalLink">equals</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang" class="externalLink">finalize</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang" class="externalLink">getClass</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang" class="externalLink">hashCode</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang" class="externalLink">notify</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang" class="externalLink">notifyAll</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang" class="externalLink">toString</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang" class="externalLink">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang" class="externalLink">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait(long,int)" title="class or interface in java.lang" class="externalLink">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<li class="blockList">
<section class="fieldDetails"><a id="field.detail">
<!--   -->
</a>
<h2>Field Details</h2>
<ul class="blockList">
<li class="blockList">
<section class="detail">
<h3><a id="NOOP">NOOP</a></h3>
<div class="memberSignature"><span class="modifiers">public static final</span>&nbsp;<span class="returnType"><a href="FinishedSpanHandler.html" title="class in brave.handler">FinishedSpanHandler</a></span>&nbsp;<span class="memberName">NOOP</span></div>
<div class="block">Use to avoid comparing against null references</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li class="blockList">
<section class="constructorDetails"><a id="constructor.detail">
<!--   -->
</a>
<h2>Constructor Details</h2>
<ul class="blockList">
<li class="blockList">
<section class="detail">
<h3><a id="&lt;init&gt;()">FinishedSpanHandler</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="memberName">FinishedSpanHandler</span>()</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li class="blockList">
<section class="methodDetails"><a id="method.detail">
<!--   -->
</a>
<h2>Method Details</h2>
<ul class="blockList">
<li class="blockList">
<section class="detail">
<h3><a id="handle(brave.propagation.TraceContext,brave.handler.MutableSpan)">handle</a></h3>
<div class="memberSignature"><span class="modifiers">public abstract</span>&nbsp;<span class="returnType">boolean</span>&nbsp;<span class="memberName">handle</span>&#8203;(<span class="arguments"><a href="../propagation/TraceContext.html" title="class in brave.propagation">TraceContext</a>&nbsp;context,
<a href="MutableSpan.html" title="class in brave.handler">MutableSpan</a>&nbsp;span)</span></div>
<div class="block">This is invoked after a span is finished, allowing data to be modified or reported out of
 process. A return value of false means the span should be dropped completely from the stream.

 <p>Changes to the input span are visible by later finished span handlers. One reason to change
 the input is to align tags, so that correlation occurs. For example, some may clean the tag
 "http.path" knowing downstream handlers such as zipkin reporting have the same value.

 <p>Returning false is the same effect as if <a href="../Span.html#abandon()"><code>Span.abandon()</code></a> was called. Implementations
 should be careful when returning false as it can lead to broken traces. Acceptable use cases
 are when the span is a leaf, for example a client call to an uninstrumented database, or a
 server call which is known to terminate in-process (for example, health-checks). Prefer an
 instrumentation policy approach to this mechanism as it results in less overhead.

 <p>Implementations should not hold a reference to it after this method returns. This is to
 allow object recycling.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>context</code> - the trace context which is <a href="../propagation/SamplingFlags.html#sampled()"><code>SamplingFlags.sampled()</code></a> or <a href="../propagation/SamplingFlags.html#sampledLocal()"><code>SamplingFlags.sampledLocal()</code></a>. This includes identifiers and potentially <a href="../propagation/TraceContext.html#extra()"><code>extra propagated data</code></a> such as extended sampling configuration.</dd>
<dd><code>span</code> - a mutable object including all data recorded with span apis. Modifications are
 visible to later handlers, including Zipkin.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true retains the span, and should almost always be used. false drops the span, making
 it invisible to later handlers such as Zipkin.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="#supportsOrphans()"><code>If you are scrubbing personal information, consider supporting orphans.</code></a>, 
<a href="../Tag.html#tag(I,brave.propagation.TraceContext,brave.handler.MutableSpan)"><code>Tag.tag(Object, TraceContext, MutableSpan)</code></a></dd>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="supportsOrphans()">supportsOrphans</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType">boolean</span>&nbsp;<span class="memberName">supportsOrphans</span>()</div>
<div class="block">Normally, <a href="#handle(brave.propagation.TraceContext,brave.handler.MutableSpan)"><code>handle(TraceContext, MutableSpan)</code></a> is only called upon explicit termination
 of a span: <a href="../Span.html#finish()"><code>Span.finish()</code></a>, <a href="../Span.html#finish(long)"><code>Span.finish(long)</code></a> or <a href="../Span.html#flush()"><code>Span.flush()</code></a>. When this
 method returns true, the callback will also receive data orphaned due to spans being never
 terminated or data added after termination. It is important to understand this, especially if
 your handler is performing work like redaction. This sort of work needs to happen on all data,
 not just the success paths.

 <h3>What is an orphaned span?</h3>

 <p>Brave adds an <a href="../Span.html#annotate(java.lang.String)"><code>annotation</code></a> "brave.flush" when data remains
 associated with a span when it is garbage collected. This is almost always a bug. For example,
 calling <a href="../Span.html#tag(java.lang.String,java.lang.String)"><code>Span.tag(String, String)</code></a> after calling <a href="../Span.html#finish()"><code>Span.finish()</code></a>, or calling <a href="../Tracer.html#nextSpan()"><code>Tracer.nextSpan()</code></a> yet never using the result. To track down bugs like this, set the logger
 <code>PendingSpans</code> to FINE level.

 <h3>Why handle orphaned spans?</h3>

 <p>Use cases for handling orphans include redaction, trimming the "brave.flush" annotation,
 logging a different way than default, or incrementing bug counters. For example, you could use
 the same credit card cleaner here as you do on the success path.

 <h3>What shouldn't handle orphaned spans?</h3>

 <p>As this is related to bugs, no assumptions can be made about span count etc. For example,
 one span context can result in many calls to this handler, unrelated to the actual operation
 performed. Handlers that redact or clean data work for normal spans and orphans. However,
 aggregation handlers, such as dependency linkers or success/fail counters, can create problems
 if used against orphaned spans.

 <h2>Implementation</h2>

 <p>By default, this method returns false, suggesting the implementation is not designed to
 also process orphans. Return true to indicate otherwise. Whichever choice should be constant.
 In other words do not sometimes return false and other times true, as the value is only read
 once.

 <h3>Considerations for implementing <code>handle</code></h3>

 <p>When this method returns true, the <a href="#handle(brave.propagation.TraceContext,brave.handler.MutableSpan)"><code>handle method</code></a>
 is both invoked for normal spans and also orphaned ones. The following apply when handling
 orphans:

 <p>The <a href="../propagation/TraceContext.html" title="class in brave.propagation"><code>TraceContext</code></a> parameter contains minimal information, including lookup ids
 (traceId, spanId and localRootId) and sampling status. <a href="../propagation/TraceContext.html#extra()"><code>"extra"</code></a>
 will be empty.

 <p>The <a href="MutableSpan.html" title="class in brave.handler"><code>MutableSpan</code></a> parameter <a href="MutableSpan.html#containsAnnotation(java.lang.String)"><code>includes
 the annotation</code></a> "brave.flush", and whatever state was orphaned (ex a tag).</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>5.7</dd>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="alwaysSampleLocal()">alwaysSampleLocal</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType">boolean</span>&nbsp;<span class="memberName">alwaysSampleLocal</span>()</div>
<div class="block">When true, all spans become real spans even if they aren't sampled remotely. This allows
 finished span handlers (such as metrics) to consider attributes that are not always visible
 before-the-fact, such as http paths. Defaults to false and affects <a href="../propagation/SamplingFlags.html#sampledLocal()"><code>SamplingFlags.sampledLocal()</code></a>.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="#handle(brave.propagation.TraceContext,brave.handler.MutableSpan)"><code>handle(TraceContext, MutableSpan)</code></a></dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/FinishedSpanHandler.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small>Copyright &#169; 2013&#x2013;2020 <a href="https://zipkin.io/">OpenZipkin</a>. All rights reserved.</small></p>
</footer>
</body>
</html>
